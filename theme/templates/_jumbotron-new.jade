doctype html
html(lang="en", style="height: 100%;")
  head
    title Save The Storks
    meta(charset='UTF-8')
    meta(name='viewport', content='width=device-width, initial-scale=1')

    //- TYPEKIT
    script(src="//use.typekit.net/duk0vdw.js")
    script(:ignore="true").
      try{Typekit.load();}catch(e){}
    script(src="https://assets.donate.io/static/widget/embed.js", :ignore="true")
    script(:ignore="true") var __rmSettings = { organization:'storks', domain:'www.savethestorks.com' }

    link(rel="shortcut icon", href="assets://favicon.ico", type="image/x-icon")
    link(rel="icon", href="assets://favicon.ico", type="image/x-icon")

    //- <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/jquery.slick/1.3.15/slick.css"/>

    link(href='assets://css/ammap.css', rel='stylesheet')
    link(href='//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css', rel='stylesheet')
    // build:css /styles/main.css
    link(href='assets://css/main.css', rel='stylesheet')
    link(href='assets://css/sts.css', rel='stylesheet')
    // endbuild

    script(:ignore="true").
     (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-36727207-1', 'auto');
      ga('send', 'pageview');
        
    -page = 'completedProjects'

    |<:ssl:on />

  body(class=page, style="height: 100%;")
    noscript
      iframe(src="//www.googletagmanager.com/ns.html?id=GTM-52FC6K", height="0", width="0", style="display:none;visibility:hidden")
    script.
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-52FC6K');
    div#wrapper: div#canvas
      header.completed-projects(style="position: relative; z-index: 3;")
        .container-fluid
          h1(class='pull-left', style="pointer-events: all;"): a(alt='Save The Storks', href='/'): img(src='assets://images/homeLogo.png' alt='Save The Storks')
          span(class='pull-right', style='position: relative; z-index: 4; pointer-events: all;')
            a(id='menuToggle', href='#menuToggle')
              |Menu
              i.nav-toggle: span
          .content
            h1 Every Movement Begins<br>with Mobility
            a(class='btn btn-green', id='explore-map') Explore The Map
        .map-overlay
        #map(style='background-color: #D4D4D4; width: 100%; height: 100%;')

      | <:jolt placeholder="content" />

    // Footer
    footer

    // build:js /scripts/main.js
    script(src='assets://bower_components/jquery/dist/jquery.js')
    script(src='//cdn.jsdelivr.net/jquery.slick/1.5.0/slick.min.js')
    script(type='text/javascript', src='assets://js/imagesLoaded.js')
    script(type='text/javascript', src='assets://js/imagefill.js')
    script(src='assets://js/build.js')
    script(src='assets://js/main.js')
    // endbuild
    script(type="text/javascript").
      var facebookAppId = '{:settings.facebook-app-id}'; 
      var $memberId = {:member.id ? :member.id : 'null'};
      var facebookChannelFile = '//{:e.url.domain()}/act/session/facebook_channel_file';
    script.
      /* <![CDATA[ */
      var google_conversion_id = 961069200;
      var google_custom_params = window.google_tag_params;
      var google_remarketing_only = true;
      /* ]]> */
    script(src="//www.googleadservices.com/pagead/conversion.js")
    noscript.
      <div style="display:inline;">
      <img height="1" width="1" style="border-style:none;" alt="" src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/961069200/?value=0&amp;guid=ON&amp;script=0"/>
      </div>
    script.
      $('.tab-toggle').on('click', function() {
        var target = $(this).data('target');
        $(this).addClass('active').siblings().removeClass('active');
        $(target).addClass('in').show().siblings('.tab').removeClass('in').hide();
        if ($(this).hasClass('completed')) {
          $('span.arrow.progress').hide()
          $('span.arrow.list').show()
        } else {
          $('span.arrow.list').hide()
          $('span.arrow.progress').show()
        }
      });
      $(window).on('load', function() {
        $('.city-bar').imagesLoaded(function() {
          $('.city-bar__list, .city-bar__progress').slick({
            slidesToShow: 5,
            slidesToScroll: 1,
            centerMode: true,
            adaptiveHeight: true,
            responsive: [
              {
                breakpoint: 1024,
                settings: {
                  slidesToShow: 3,
                  slidesToScroll: 3,
                  infinite: true,
                },
              },
              {
                breakpoint: 768,
                settings: {
                  slidesToShow: 2,
                  slidesToScroll: 2,
                  infinite: true
                }
              }
            ]
          });
          $('.city-bar__progress').parent().hide();
          $('.loading').fadeOut();
          $('.city-bar').css({
            overflow: 'visible'
          });
        });
      });
      $('.arrow.next.list').on('click', function() {
        $('.city-bar__list').slick('slickNext');
      });
      $('.arrow.prev.list').on('click', function() {
        $('.city-bar__list').slick('slickPrev');
      });
      $('.arrow.next.progress').on('click', function() {
        $('.city-bar__progress').slick('slickNext');
      });
      $('.arrow.prev.progress').on('click', function() {
        $('.city-bar__progress').slick('slickPrev');
      });
      $('.city-bar__progress li .thumbnail').on('click', function() {
        $('.project-tabs').find('.in').removeClass('in');
      });
      $('.table-fill td').each(function() {
        $(this).imagefill();
      });
    script(src='https://maps.googleapis.com/maps/api/js?key=AIzaSyAY4UeZE328Mf4VB6iFINcMVWP4zoQOeeM&v=3.exp')
    //-   <script :delimiter="%" :build-cache="10m">
    //-   var markers = [];
    //-       var gpsCoords, exploded, lat, lng, tmpHtml, groupLocation;
    //-       var projects_json = %:api.projects.has_status(active,completed).all|json%;
    script.
      var projects = {:api(3.0).content(site.completed-projects).relationships(completedprojects).all|json};
      var progress = {:api(3.0).content(site.in-progress-projects).relationships(inprogress).all|json};
      var map, geocoder, id;
      function initialize() {
        //- Build & Style Map  
        var mapOptions = {
          center: new google.maps.LatLng(41.850033, -98.6500523),
          scrollwheel: false,
          minZoom: 4,
          zoom: 5,
          maxZoom: 5,
          styles: [{"featureType":"landscape","stylers":[{"saturation":-100},{"lightness":65},{"visibility":"on"}]},{"featureType":"poi","stylers":[{"saturation":-100},{"lightness":51},{"visibility":"simplified"}]},{"featureType":"road.highway","stylers":[{"saturation":-100},{"visibility":"simplified"}]},{"featureType":"road.arterial","stylers":[{"saturation":-100},{"lightness":30},{"visibility":"on"}]},{"featureType":"road.local","stylers":[{"saturation":-100},{"lightness":40},{"visibility":"on"}]},{"featureType":"transit","stylers":[{"saturation":-100},{"visibility":"simplified"}]},{"featureType":"administrative.province","stylers":[{"visibility":"off"}]},{"featureType":"water","elementType":"labels","stylers":[{"visibility":"on"},{"lightness":-25},{"saturation":-100}]},{"featureType":"water","elementType":"geometry","stylers":[{"hue":"#ffff00"},{"lightness":-25},{"saturation":-97}]}]
        };
        //- Create Map from Options
        map      = new google.maps.Map(document.getElementById('map'), mapOptions);
        //- Declare Geocoder to get Lat/Long from City Name
        geocoder = new google.maps.Geocoder();
        //- Geocode Each City
        for (i = 0; i < projects.length; i++) {
          (function(i) {
            var project = projects[i];
            geocoder.geocode({address: ""+project.content.name}, function(results, status) {
              var marker = new google.maps.Marker({
                position: new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng()),
                map: map,
                target: project.id,
                index: i
              });
              google.maps.event.addListener(marker, 'click', function() {
                map.setZoom(8)
                map.setCenter(marker.getPosition());
                if ($('#progress').is(':visible')) {
                  $('#progress').hide().removeClass('in')
                  $('#completed').show().addClass('in')
                  $('span.progress').removeClass('active')
                  $('span.completed').addClass('active')
                }
                $('#' + marker.target).addClass('in').siblings().removeClass('in');
                $('#project-' + marker.target).addClass('active').parents('li').siblings().find('.active').removeClass('active');
                $('.city-bar__list').slick('slickGoTo', marker.index);
                $('html,body').animate({
                  scrollTop: $('.city-bar').offset().top
                }, 500);
              });
            });
          })(i);
        }
        for (i = 0; i < progress.length; i++) {
          (function(i) {
            var project = progress[i];
            geocoder.geocode({address: ""+project.content.name}, function(results, status) {
              var marker = new google.maps.Marker({
                position: new google.maps.LatLng(results[0].geometry.location.lat(), results[0].geometry.location.lng()),
                map: map,
                title: project.content.name,
                index: i
              });
              google.maps.event.addListener(marker, 'click', function() {
                map.setZoom(8);
                map.setCenter(marker.getPosition());
                $('#' + marker.target).addClass('in').siblings().removeClass('in');
                if ($('#completed').is(':visible')) {
                  $('#completed').hide().removeClass('in')
                  $('#progress').show().addClass('in')
                  $('span.completed').removeClass('active')
                  $('span.progress').addClass('active')
                }
                //- $('.city-bar__progress').slick('slickGoTo', marker.index);
              });
            });
          })(i);
        }
      }
      google.maps.event.addDomListener(window, 'load', initialize);